name: Update Data Daily

on:
  schedule:
    # Ch·∫°y v√†o c√°c khung gi·ªù: 6h, 9h, 11h, 14h, 17h, 19h, 21h, 23h (gi·ªù VN, UTC+7)
    # V√Ä th√™m 0h UTC (7h s√°ng VN) ƒë·ªÉ c·∫≠p nh·∫≠t gi√° v√†ng
    - cron: '0 0,2,4,7,10,12,14,16,23 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.MY_PAT }}

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Python dependencies
        run: |
          pip install feedparser beautifulsoup4 requests
          pip install selenium webdriver-manager

      - name: Install Chrome for Selenium
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser

      - name: Run update script
        run: python fetch_news.py

      - name: Commit and push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          # Th√™m t·∫•t c·∫£ file JSON
          files_changed=false
          for file in news.json lottery.json giavang.json; do
            if [ -f "$file" ]; then
              git add "$file"
              files_changed=true
            fi
          done
          
          if [ "$files_changed" = true ]; then
            current_time=$(date -d '+7 hours' '+%Y-%m-%d %H:%M')
            git commit -m "ü§ñ Auto-update at $current_time (VN) - News, lottery, gold" || echo "No changes to commit"
            git push
            echo "‚úÖ ƒê√£ commit v√† push th√†nh c√¥ng!"
          else
            echo "‚ö†Ô∏è Kh√¥ng c√≥ file JSON n√†o ƒë·ªÉ commit."
          fi
